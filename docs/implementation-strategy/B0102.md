# B0102: テーブル作成

## 概要
Instagram分析アプリ用のSupabaseテーブル5つを作成

## 実装戦略

### 1. SQLファイル作成 (30分)
```sql
-- backend/sql/create_tables.sql として作成
-- 5テーブル: users, instagram_accounts, daily_account_stats, media_posts, daily_media_stats
```

### 2. Supabaseダッシュボードで実行 (60分)
- SQL Editorで直接実行
- テーブル作成確認
- 制約・リレーション確認

### 3. Pythonから動作確認 (60分)
```python
# models/database.py のcreate_tables()メソッドをテスト用に修正
# テーブル存在確認
# 基本CRUD操作テスト
```

### 4. サンプルデータ投入テスト (30分)
```python
# 各テーブルにサンプルレコード1件ずつ投入
# SELECT文で取得確認
```

## 5テーブル構成

### 1. users (認証用)
```sql
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    username VARCHAR(50) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### 2. instagram_accounts (アカウント管理)
```sql
CREATE TABLE instagram_accounts (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    ig_user_id VARCHAR(50) UNIQUE NOT NULL,
    access_token TEXT NOT NULL,
    username VARCHAR(100) NOT NULL,
    profile_picture_url TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### 3. daily_account_stats (日次アカウント統計)
```sql
CREATE TABLE daily_account_stats (
    id SERIAL PRIMARY KEY,
    date DATE NOT NULL,
    ig_user_id VARCHAR(50) NOT NULL,
    followers_count INTEGER NOT NULL,
    follows_count INTEGER NOT NULL,
    media_count INTEGER NOT NULL,
    profile_views INTEGER,
    website_clicks INTEGER,
    UNIQUE(date, ig_user_id),
    FOREIGN KEY (ig_user_id) REFERENCES instagram_accounts(ig_user_id)
);
```

### 4. media_posts (投稿データ)
```sql
CREATE TABLE media_posts (
    id SERIAL PRIMARY KEY,
    ig_media_id VARCHAR(50) UNIQUE NOT NULL,
    ig_user_id VARCHAR(50) NOT NULL,
    timestamp TIMESTAMP NOT NULL,
    media_type VARCHAR(20) NOT NULL,
    caption TEXT,
    media_url TEXT NOT NULL,
    thumbnail_url TEXT,
    permalink TEXT NOT NULL,
    FOREIGN KEY (ig_user_id) REFERENCES instagram_accounts(ig_user_id)
);
```

### 5. daily_media_stats (日次投稿統計)
```sql
CREATE TABLE daily_media_stats (
    id SERIAL PRIMARY KEY,
    date DATE NOT NULL,
    ig_media_id VARCHAR(50) NOT NULL,
    like_count INTEGER NOT NULL,
    comments_count INTEGER NOT NULL,
    reach INTEGER,
    views INTEGER,
    shares INTEGER,
    saved INTEGER,
    UNIQUE(date, ig_media_id),
    FOREIGN KEY (ig_media_id) REFERENCES media_posts(ig_media_id)
);
```

## 完了条件
- [ ] 5テーブル作成完了
- [ ] 外部キー制約設定完了
- [ ] Pythonから接続確認完了
- [ ] サンプルデータ投入・取得確認完了

## PoC配慮
- インデックスは最小限（主キーのみ）
- RLS無効（Row Level Security）
- 複雑な制約は設定しない