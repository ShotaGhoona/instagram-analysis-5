# F0701-F0702: アカウント選択UI + 切り替えロジック実装

## 概要
ヘッダーのアカウント切り替えpopoverを実装。アカウント一覧表示、選択、URL変更によるページ切り替え。

## 現状確認
✅ B0202完了: `/accounts` APIでアカウント一覧取得可能
✅ 既存ヘッダー: プレースホルダーのアカウント表示部分あり
✅ 3つのseedアカウント: メイン、サブ、ビジネス

## 実装戦略

### 1. APIクライアント関数追加 (15分)
`frontend/src/lib/api-client.ts` にアカウント取得関数追加:
- `getAccounts()` - 全アカウント一覧
- `getAccount(ig_user_id)` - 個別詳細（必要に応じて）

### 2. アカウントContext作成 (45分)
`frontend/src/contexts/account-context.tsx`:
- AccountProvider実装
- アカウント一覧取得・管理
- 現在のアカウント状態管理
- URL同期でのアカウント切り替え
- useAccount() hook提供

### 3. Root Layout更新 (10分)
`frontend/src/app/layout.tsx`:
- AccountProviderを既存AuthProviderと組み合わせ
- Context階層を適切に設定

### 4. アカウント選択Comboboxコンポーネント作成 (40分)
`frontend/src/components/account/account-selector.tsx`:
- shadcn/ui Combobox（Popover + Command）使用
- useAccount() からアカウント一覧取得
- 検索機能付きアカウント選択
- switchAccount()でURL変更

### 5. Header統合 (20分)
`frontend/src/components/layout/header.tsx` 修正:
- AccountSelector統合
- useAccount() で現在のアカウント表示
- プレースホルダー部分を実装と置き換え

## ファイル構成
```
frontend/src/
├── contexts/
│   └── account-context.tsx       # 新規作成
├── lib/api-client.ts             # API関数追加
├── app/layout.tsx               # AccountProvider追加
├── components/
│   ├── account/
│   │   └── account-selector.tsx  # 新規作成
│   └── layout/
│       └── header.tsx           # 修正
```

## 完了条件
- [ ] AccountContextが全ページで利用可能
- [ ] useAccount() hookでアカウント情報取得可能
- [ ] アカウント切り替えComboboxが表示される
- [ ] 3つのseedアカウントが一覧表示される
- [ ] アカウント選択でURL変更される（例: `/analytics/account/17841455808057231/yearly`）
- [ ] 現在のアカウント名がヘッダーに表示される
- [ ] ページリロード時にURLのアカウントIDが正しく反映される
- [ ] 検索機能でアカウント名・ユーザー名検索可能

## PoC配慮
- popoverの高度なアニメーション等は最小限
- エラーハンドリングは基本的なもののみ
- アカウント画像は仮画像でOK
- レスポンシブ対応は後回し

## 依存関係
- ✅ B0202: アカウント情報取得API
- ✅ shadcn/ui: Popover, Command, Button コンポーネント
- ✅ lucide-react: ChevronsUpDown, Check アイコン
- ✅ 既存認証システム（useAuth）

## Combobox実装仕様
shadcn/ui Comboboxパターンを使用:
- Popover + Command コンポーネント構成
- CommandInput で検索機能
- CommandList でアカウント一覧表示
- Check アイコンで選択状態表示
- ChevronsUpDown でドロップダウン表示

```tsx
// 基本構成
<Popover>
  <PopoverTrigger>
    <Button>👤 @current_username ▼</Button>
  </PopoverTrigger>
  <PopoverContent>
    <Command>
      <CommandInput placeholder="アカウント検索..." />
      <CommandList>
        <CommandEmpty>アカウントが見つかりません</CommandEmpty>
        <CommandGroup>
          {accounts.map(account => (
            <CommandItem key={account.ig_user_id}>
              👤 {account.name} (@{account.username})
              <Check className={selected ? "visible" : "hidden"} />
            </CommandItem>
          ))}
        </CommandGroup>
      </CommandList>
    </Command>
  </PopoverContent>
</Popover>
```

## 変更点
- ❌ アカウント追加ボタン削除（スコープ外）
- ✅ Combobox + 検索機能採用
- ✅ シンプルなアカウント切り替えに特化