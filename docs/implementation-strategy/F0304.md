# F0304: 年間分析API連携・データ統合実装戦略

## 概要
年間分析ページのmockデータからリアルAPI連携への移行。B0302で実装した年間分析APIエンドポイントをフロントエンドと統合し、実際のデータベースデータを表示可能にする。

## 実装戦略

### 1. API Client拡張 (0.5時間)
`frontend/src/lib/api.ts`のgetYearlyAnalyticsメソッド実装
- **パラメータ追加**: year（オプション）対応
- **エラーハンドリング**: APIエラー時の適切な処理
- **型安全性**: YearlyAnalytics型レスポンス確保
- **既存パターン踏襲**: getPostsAnalyticsと同じ構造

### 2. カスタムフック作成 (0.5時間)
`frontend/src/hooks/use-yearly-analytics.ts`を新規作成
- **データフェッチ**: API呼び出しとローディング状態管理
- **エラー状態**: エラー時の適切な状態管理
- **リフェッチ機能**: データ再取得機能
- **既存パターン踏襲**: use-filter-stateと同じ構造

### 3. 年間分析ページ更新 (0.75時間)
`frontend/src/app/analytics/account/[accountId]/yearly/page.tsx`をmock→API切り替え
- **mockデータ削除**: import文とデータ参照を削除
- **API統合**: useYearlyAnalyticsフック使用
- **ローディング状態**: Skeleton表示追加
- **エラー状態**: エラー表示とリトライ機能
- **フォールバック**: データなし時の適切な表示

### 4. 動作確認・調整 (0.25時間)
- **E2Eテスト**: ブラウザでの動作確認
- **エラーケース**: 存在しないアカウント、ネットワークエラー
- **パフォーマンス**: ローディング時間確認

## 完了条件
- [ ] API Clientにパラメータ付きgetYearlyAnalyticsメソッド追加
- [ ] カスタムフックでデータ取得・エラー・ローディング状態管理
- [ ] 年間分析ページがリアルAPIからデータ表示
- [ ] ローディング・エラー状態が適切に表示
- [ ] mockデータ完全削除、import文クリーンアップ
- [ ] 存在するアカウントで正常データ表示確認

## 技術仕様

### API Client拡張
```typescript
// lib/api.ts
async getYearlyAnalytics(accountId: string, year?: number) {
  const params = new URLSearchParams()
  if (year) params.set('year', year.toString())
  
  return this.request(`/analytics/yearly/${accountId}?${params}`)
}
```

### カスタムフック
```typescript
// hooks/use-yearly-analytics.ts
export function useYearlyAnalytics(accountId: string, year?: number) {
  const [data, setData] = useState<YearlyAnalytics | null>(null)
  const [loading, setLoading] = useState(true)
  const [error, setError] = useState<string | null>(null)

  // useEffect for API call
  // return { data, loading, error, refetch }
}
```

### ページ統合
```typescript
// app/analytics/account/[accountId]/yearly/page.tsx
export default function YearlyAnalyticsPage({ params }: YearlyAnalyticsPageProps) {
  const resolvedParams = use(params)
  const { data, loading, error, refetch } = useYearlyAnalytics(resolvedParams.accountId)

  if (loading) return <YearlyPageSkeleton />
  if (error) return <ErrorDisplay error={error} onRetry={refetch} />
  if (!data) return <NoDataDisplay />

  return (
    <div>
      <YearlyTable data={data} />
      <YearlyFollowerChart data={data.monthly_stats} />
      <YearlyEngagementChart data={data.monthly_stats} />
    </div>
  )
}
```

## エラーハンドリング仕様

### エラーケース対応
- **404**: アカウント不存在 → "アカウントが見つかりません"
- **500**: サーバーエラー → "データ取得に失敗しました"
- **Network**: 接続エラー → "ネットワークエラーです"
- **No Data**: データなし → "データがありません"

### ローディング状態
- **Skeleton**: テーブル・グラフ部分のSkeleton表示
- **初回ロード**: ページ全体のローディング
- **リフェッチ**: ボタン無効化

## データフロー変更

### Before (mockデータ)
```
Page → mockYearlyData → Components
```

### After (API統合)
```
Page → useYearlyAnalytics → API → Database → Components
```

## PoC配慮
- **エラーハンドリング最小限**: 基本的な表示のみ
- **リトライ機能**: シンプルなボタンクリック再実行
- **キャッシュなし**: 毎回API呼び出し
- **パフォーマンス**: 基本的な最適化のみ

## 次への依存関係
- **F0403 月間分析API統合**: 同じパターンで実装予定
- **B0303 月間分析API**: 年間API完了後に実装予定