# B0206: エラーハンドリング（API制限、トークン失効対応）

## 概要
Instagram API呼び出しとデータベース操作で発生するエラーの適切な処理を実装する。PoC開発なので、オーバーエンジニアリングを避け、実用性重視の最小限実装を行う。

## 既存コード分析結果
- **良い点**: FastAPIのHTTPException、try-catch文、instagram_clientのmake_request()でエラー処理は基本的に実装済み
- **不足点**: Instagram API特有のエラー（トークン失効、レート制限）の専用処理なし

## 実装戦略

### 1. Instagram API特有エラーの統一処理 (2時間)
- トークン失効（401/403）の検出と適切なメッセージ
- レート制限（429）の検出と待機提案
- 一時的なAPI障害（5xx）の識別
- 既存instagram_clientのmake_request()を拡張

### 2. データベースエラーの改善 (1時間)
- Supabase接続失敗の明確なメッセージ
- 重複データ挿入エラーの適切な処理
- リポジトリ層のエラーレスポンス統一

### 3. ログ機能の改善 (1時間)
- エラー発生時の詳細情報記録
- Instagram APIエラーの構造化ログ
- デバッグ用情報の追加

## 完了条件
- [ ] Instagram APIエラー（401/403/429/5xx）が適切に分類される
- [ ] エラーメッセージが日本語で統一される
- [ ] データベースエラーが明確に識別される
- [ ] ログ出力が構造化される
- [ ] 既存機能の動作に影響しない

## PoC配慮
- **やらないこと**: 自動リトライ、トークン自動更新、複雑なエラー復旧
- **最小限実装**: エラー分類とメッセージ改善のみ
- **実用性重視**: ユーザーが問題を理解しやすいメッセージ
- **工数制限**: 4時間以内で完了