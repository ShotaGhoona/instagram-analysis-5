# F0601-F0603: フィルター機能実装

## 概要
投稿分析ページに日付範囲選択とメディアタイプフィルタリング機能を実装。shadcn/ui Calendar、Select、状態管理フックを使用してインタラクティブなフィルター機能を提供する。

## 実装戦略

### 1. 日付フィルター（F0601） (2.5時間)
#### Date Range Picker実装
- `src/components/filters/date-filter.tsx`作成
- shadcn/ui CalendarとPopoverを組み合わせ
- 日付範囲選択UI：「2025/08/01 - 2025/08/31」形式
- デフォルト：当月1日〜末日

#### コンポーネント仕様
```tsx
interface DateFilterProps {
  value: DateRange | undefined
  onChange: (dateRange: DateRange | undefined) => void
}
```

### 2. メディアタイプフィルター（F0602） (1.5時間)
#### Multi-Select実装
- `src/components/filters/media-type-filter.tsx`作成
- shadcn/ui Selectまたはチェックボックス群
- 選択肢：「All」「IMAGE」「VIDEO」「CAROUSEL」（「STORY」は将来拡張）
- デフォルト：「All」選択状態

#### UI表示
- 複数選択可能なドロップダウン
- 選択済みタグ表示（例：「IMAGE, VIDEO」）

### 3. フィルター状態管理（F0603） (2時間)
#### カスタムフック作成
- `src/hooks/use-filter-state.ts`作成
- 日付範囲とメディアタイプの状態管理
- フィルター適用ロジック（mockデータのフィルタリング）

#### 状態管理仕様
```tsx
interface FilterState {
  dateRange: DateRange | undefined
  mediaTypes: MediaType[]
}

export function useFilterState() {
  // フィルター状態管理
  // フィルタリング済みデータ返却
  // リセット機能
}
```

### 4. 投稿分析ページ統合 (1時間)
#### フィルター UI統合
- 既存のプレースホルダーをフィルター機能に置き換え
- PostsTableとPostsPerformanceChartにフィルター済みデータを渡す
- フィルター状態の表示更新

#### レイアウト調整
- フィルターコンポーネントの配置調整
- 「適用」ボタンまたはリアルタイムフィルタリング選択

## 完了条件
- [ ] 日付範囲選択が正常に動作する
- [ ] メディアタイプの複数選択が可能
- [ ] フィルター適用でテーブルとグラフが更新される
- [ ] フィルター状態がUIに正確に反映される
- [ ] TypeScript型エラーがない
- [ ] デザインが既存ページと統一されている

## PoC配慮
- **URL同期は簡素化**: useState使用、URL同期は将来実装
- **パフォーマンス最適化なし**: メモ化は不要（データ量少）
- **複雑なバリデーション無し**: 基本的な入力チェックのみ
- **エラーハンドリング最小限**: 正常系の動作確認を優先

## スコープ外機能
```tsx
// TODO: URL同期機能（router.push等）
// TODO: フィルター履歴機能
// TODO: プリセットフィルター（今週、先月等）
// TODO: 高度な日付バリデーション
// TODO: パフォーマンス最適化（useMemo、useCallback）
```

## 技術詳細

### 日付フィルター実装例
```tsx
// components/filters/date-filter.tsx
export function DateFilter({ value, onChange }: DateFilterProps) {
  return (
    <Popover>
      <PopoverTrigger asChild>
        <Button variant="outline">
          📅 {value ? formatDateRange(value) : "期間を選択"}
        </Button>
      </PopoverTrigger>
      <PopoverContent className="w-auto p-0">
        <Calendar
          mode="range"
          selected={value}
          onSelect={onChange}
          numberOfMonths={2}
        />
      </PopoverContent>
    </Popover>
  )
}
```

### フィルタリングロジック
```tsx
// hooks/use-filter-state.ts
export function useFilterState(initialPosts: MediaPost[]) {
  const [dateRange, setDateRange] = useState<DateRange | undefined>()
  const [mediaTypes, setMediaTypes] = useState<MediaType[]>([])

  const filteredPosts = useMemo(() => {
    return initialPosts.filter(post => {
      // 日付フィルター
      if (dateRange) {
        const postDate = new Date(post.timestamp)
        if (postDate < dateRange.from || postDate > dateRange.to) {
          return false
        }
      }
      
      // メディアタイプフィルター
      if (mediaTypes.length > 0) {
        if (!mediaTypes.includes(post.media_type)) {
          return false
        }
      }
      
      return true
    })
  }, [initialPosts, dateRange, mediaTypes])

  return {
    dateRange,
    setDateRange,
    mediaTypes, 
    setMediaTypes,
    filteredPosts
  }
}
```

### メディアタイプフィルター実装例
```tsx
// components/filters/media-type-filter.tsx
export function MediaTypeFilter({ value, onChange }: MediaTypeFilterProps) {
  const options = [
    { value: 'IMAGE', label: 'IMAGE' },
    { value: 'VIDEO', label: 'VIDEO' },
    { value: 'CAROUSEL_ALBUM', label: 'CAROUSEL' },
    // TODO: { value: 'STORY', label: 'STORY' } 将来実装
  ]

  return (
    <MultiSelect
      options={options}
      value={value}
      onChange={onChange}
      placeholder="タイプを選択"
    />
  )
}
```

## 実装順序
1. **DateFilter コンポーネント** → shadcn/ui Calendar統合
2. **MediaTypeFilter コンポーネント** → Select UI作成  
3. **useFilterState フック** → フィルタリングロジック実装
4. **ページ統合** → 既存テーブル・グラフとの連携
5. **UI調整** → レイアウト・スタイリング最終調整

## 参考
- [shadcn/ui Calendar](https://ui.shadcn.com/docs/components/calendar)
- [Date Range Picker実装例](https://ui.shadcn.com/docs/components/date-picker)
- [既存デザイン](../requirement-definition/03-page-design.md) - フィルター仕様